<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B-7：使用半边结构实现网格简化算法QSlim</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li>
<ul>
<li></li>
</ul>
</li>
<li>
<ul>
<li></li>
<li></li>
<li></li>
</ul>
</li>
<li>
<ul>
<li></li>
<li></li>
<li></li>
</ul>
</li>
<li></li>
<li>
<ul>
<li></li>
<li></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <p></p><div class="toc"><h3>B-7. 使用半边结构实现网格简化算法QSlim</h3><ul><li><a href="#_5">算法介绍</a></li><ul><li><a href="#_6">概述</a></li><li><a href="#_39">初始化</a></li><li><a href="#_55">迭代过程</a></li></ul><li><a href="#_59">算法实现</a></li><ul><li><a href="#initQEM_60">initQEM</a></li><li><a href="#runQEM_163">runQEM</a></li><li><a href="#helper_functions_295">helper functions</a></li><ul><li><a href="#is_collapse_OK_296">is_collapse_OK</a></li><li><a href="#zycollapse_391">zycollapse</a></li></ul></ul><li><a href="#_514">交互控制简化程度</a></li><li><a href="#_554">效果</a></li><ul><li><a href="#_555">斯坦福兔子</a></li><li><a href="#_572">斯坦福牛</a></li></ul></ul></div><br>
作业要求：<p></p>
<ol>
<li>实现文章 <a href="http://mgarland.org/research/quadrics.html">Surface Simplification Using Quadric Error Metrics</a>, by Michael Garland and Paul Heckbert, SIGGRAPH97</li>
<li>可交互选择控制网格简化选项</li>
</ol>
<h1><a id="_5"></a>算法介绍</h1>
<h2><a id="_6"></a>概述</h2>
<p>网格简化算法包括顶点去除、顶点聚集、迭代边收缩等方法。QSlim算法有点类似边收缩的一类，但也有不同。它通过<strong>点对之间的缩并</strong>来达到边收缩的目的。当要缩并某一点对<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>v</mi><mn>1</mn><mo separator="true">,</mo><mi>v</mi><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(v1,v2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span>时，如果<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>v</mi><mn>1</mn><mo separator="true">,</mo><mi>v</mi><mn>2</mn><mo stretchy="false">)</mo><mo>∈</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">(v1,v2)\in E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span></span></span></span></span>，如下左图所示，则相当于边收缩；否则，将两个顶点视作有虚拟边链接，如下右图所示，并将该虚拟便缩并得到新的顶点。两种情况的最终结果都是顶点数减1。</p>
<p>这也是QSlim算法与保持原网格拓扑的其它算法的不同。QSlim虽然保持网格大致的形状，但不保证拓扑关系不变，如下右图所示就是一种拓扑改变的情况。<br>
<img src="https://img-blog.csdnimg.cn/7a42222cac6b483fb35a19483b93ae12.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>
QSlim是基于平方误差度量的网格简化算法，即在缩减顶点时采用的原则是选择能使缩减后产生的平方误差最小的那个点对。文章采用平方误差来度量，具有二次型问题计算方便等的优势。</p>
<p>为了在给定的迭代中选择要执行的收缩点对，需要一个<strong>收缩代价</strong>的概念。为了定义这个代价，作者试图描述在每个顶点上的误差。为此，作者将对称的4×4矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">Q</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88055em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span></span></span></span></span>与每个顶点相关联，并定义顶点<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">v</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>v</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>y</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>z</mi></msub><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\boldsymbol{v}=[v_x,v_y,v_z,1]^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.44444em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.12744em; vertical-align: -0.286108em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>处的误差为二次型：<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Δ</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi mathvariant="bold-italic">v</mi><mi>T</mi></msup><mi mathvariant="bold-italic">Q</mi><mi mathvariant="bold-italic">v</mi></mrow><annotation encoding="application/x-tex">Δ(\boldsymbol{v})=\boldsymbol{v}^T\boldsymbol{Q}\boldsymbol{v}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Δ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.08577em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span></span></span></span></span></span><br>
注意，等值面<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Δ</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo><mo>=</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">Δ(\boldsymbol{v})=\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Δ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">ϵ</span></span></span></span></span>是一个二次曲面，它是关于<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">Q</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88055em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span></span></span></span></span>的误差为<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">ϵ</span></span></span></span></span>的所有点的集合。</p>
<p>对于一个给定的收缩<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="bold-italic">v</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>→</mo><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">(\boldsymbol{v}_1, \boldsymbol{v}_2)→\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>，必须得出一个新的矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{Q}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.01733em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span>，它近似于<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>的误差。作者选择使用简单的加法规则<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><mo>=</mo><msub><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><mn mathvariant="bold-italic">1</mn></msub><mo>+</mo><msub><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><mn mathvariant="bold-italic">2</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{Q}}=\boldsymbol{\bar{Q}_1} + \boldsymbol{\bar{Q}_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.01733em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.01733em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.01733em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>。同时还必须给出新顶点<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>的选择方式，作者选用能使<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Δ</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Δ(\boldsymbol{v})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Δ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose">)</span></span></span></span></span>最小的那个点，由于二次型的极值问题是容易求解的，因此可以通过令<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi mathvariant="normal">Δ</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi mathvariant="normal">Δ</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>y</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi mathvariant="normal">Δ</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>z</mi></mrow></mfrac><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\frac{\partial{Δ}}{\partial{x}}=\frac{\partial{Δ}}{\partial{y}}=\frac{\partial{Δ}}{\partial{z}}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.22511em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.880108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mtight">Δ</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.36122em; vertical-align: -0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.880108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mtight">Δ</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.481108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.22511em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.880108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.04398em;">z</span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right: 0.05556em;">∂</span><span class="mord mtight"><span class="mord mtight">Δ</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>计算，这等价于：<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>13</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>14</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>23</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>24</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>31</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>32</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>33</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>34</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\begin{bmatrix}
q_{11}&amp;q_{12}&amp;q_{13}&amp;q_{14}\\
q_{21}&amp;q_{22}&amp;q_{23}&amp;q_{24}\\
q_{31}&amp;q_{32}&amp;q_{33}&amp;q_{34}\\
0&amp;0&amp;0&amp;1
\end{bmatrix} \boldsymbol{\bar{v}}=
\begin{bmatrix}
0 \\ 0 \\ 0 \\ 1
\end{bmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 4.80204em; vertical-align: -2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 4.80204em; vertical-align: -2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span><br>
假定这个矩阵是可逆的，我们可以解出<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>。如果这个矩阵是不可逆的，则试图找到沿着<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{v_1v_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>段的最优顶点。如果这也失败了，我们回到从端点和中点之间选择<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>。</p>
<p>简化算法是建立在顶点对收缩和误差二次曲线的计算的基础上。作者的实现用一个邻接图结构来模拟：顶点、边和面都被显式地表示并连接在一起。为了跟踪有效对的集合，每个顶点维护一个它是其成员的对的列表。整个算法步骤如下：</p>
<ol>
<li>初始化过程：
<ol>
<li>计算所有初始顶点的<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">Q</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88055em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span></span></span></span></span>矩阵。</li>
<li>选择所有的有效顶点对（即可以做收缩的顶点对）</li>
<li>计算每个有效顶点对<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\boldsymbol{v_1},\boldsymbol{v_2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>的最佳收缩目标<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>。这个目标顶点的误差<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mi>T</mi></msup><mo stretchy="false">(</mo><mrow><msub><mi mathvariant="bold-italic">Q</mi><mn mathvariant="bold-italic">1</mn></msub><mo mathvariant="bold-italic">+</mo><msub><mi mathvariant="bold-italic">Q</mi><mn mathvariant="bold-italic">2</mn></msub></mrow><mo stretchy="false">)</mo><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}^T(\boldsymbol{Q_1+Q_2})\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.09133em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin mathbf">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord boldsymbol">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>成为这一顶点对的收缩代价。</li>
<li>建立小顶堆。将所有的有效顶点对放在一个堆中，以成本为键值维护偏序，最小成本的顶点对位于堆顶。</li>
</ol>
</li>
<li>迭代收缩过程：贪心策略，迭代地从堆中删除成本最低的对<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\boldsymbol{v_1},\boldsymbol{v_2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，收缩该顶点对，并更新涉及<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{v_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>的所有有效顶点对<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="bold-italic">v</mi><mo mathvariant="bold-italic">∗</mo></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\boldsymbol{v_1},\boldsymbol{v_*})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.180554em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mathbf mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>的成本。</li>
</ol>
<h2><a id="_39"></a>初始化</h2>
<p>初始化过程中重要的一步是如何计算各个顶点的初始<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">Q</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88055em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span></span></span></span></span>矩阵。作者选择了一种启发式的方法来表征几何误差。注意到，在原始模型中，每个顶点都是一组平面的交集的解——也就是在该顶点上相交的三角形的平面。我们可以将一组平面与每个顶点相关联，从而将顶点相对于这个集合的误差定义为其平面距离的平方和：<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Δ</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">Δ</mi><mo stretchy="false">(</mo><msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>v</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>y</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>z</mi></msub><mo separator="true">,</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mi>T</mi></msup><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mrow><mi mathvariant="bold-italic">p</mi><mo>∈</mo><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo></mrow></munder><mo stretchy="false">(</mo><msup><mi mathvariant="bold-italic">p</mi><mi>T</mi></msup><mi mathvariant="bold-italic">v</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">Δ(\boldsymbol{v})=Δ(\begin{bmatrix}v_x, v_y, v_z, 1 \end{bmatrix}^T)=\sum_{\boldsymbol{p}\in planes(\boldsymbol{v})}(\boldsymbol{p}^T\boldsymbol{v})^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Δ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.43124em; vertical-align: -0.35001em;"></span><span class="mord">Δ</span><span class="mopen">(</span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.85em;"><span class="" style="top: -3.01em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.35em;"><span class=""></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.08123em;"><span class="" style="top: -3.3029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.56601em; vertical-align: -1.51601em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.80899em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight">p</span></span></span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.51601em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">p</mi><mo>=</mo><mo stretchy="false">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi><mo separator="true">,</mo><mi>d</mi><msup><mo stretchy="false">]</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\boldsymbol{p} = [a,b ,c, d]^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.63888em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.09133em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">d</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>表示由方程<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi><mi>y</mi><mo>+</mo><mi>c</mi><mi>z</mi><mo>+</mo><mi>d</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">ax + by + cz + d = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>定义的平面，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>+</mo><msup><mi>c</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a^2 + b^2 + c^2 = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.897438em; vertical-align: -0.08333em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.897438em; vertical-align: -0.08333em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>。一个顶点上的平面集合被初始化为在该顶点上相交的三角形的平面。作者并没有显式地跟踪这些平面集，因为如果要在收缩<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="bold-italic">v</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>→</mo><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">(\boldsymbol{v}_1, \boldsymbol{v}_2)→\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>之后使用遵循规则:<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo><mo>=</mo><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><msub><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mn mathvariant="bold-italic">1</mn></msub><mo stretchy="false">)</mo><mo>∪</mo><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><msub><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mn mathvariant="bold-italic">2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">planes(\boldsymbol{\bar{v}})=planes(\boldsymbol{\bar{v}_1})\cup planes(\boldsymbol{\bar{v}_2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，将会需要大量不会随着简化过程进行而减少的存储空间！！！</p>
<p>上述的误差衡量式可以改写成二次型：<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Δ</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mrow><mi mathvariant="bold-italic">p</mi><mo>∈</mo><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo></mrow></munder><mo stretchy="false">(</mo><msup><mi mathvariant="bold-italic">v</mi><mi>T</mi></msup><mi mathvariant="bold-italic">p</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msup><mi mathvariant="bold-italic">p</mi><mi>T</mi></msup><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mrow><mi mathvariant="bold-italic">p</mi><mo>∈</mo><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo></mrow></munder><msup><mi mathvariant="bold-italic">v</mi><mi>T</mi></msup><mo stretchy="false">(</mo><mi mathvariant="bold-italic">p</mi><msup><mi mathvariant="bold-italic">p</mi><mi>T</mi></msup><mo stretchy="false">)</mo><mi mathvariant="bold-italic">v</mi><mo>=</mo><msup><mi mathvariant="bold-italic">v</mi><mi>T</mi></msup><munder><mo>∑</mo><mrow><mi mathvariant="bold-italic">p</mi><mo>∈</mo><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo></mrow></munder><msub><mi mathvariant="bold-italic">K</mi><mi mathvariant="bold-italic">p</mi></msub><mi mathvariant="bold-italic">v</mi></mrow><annotation encoding="application/x-tex">Δ(\boldsymbol{v})=\sum_{\boldsymbol{p}\in planes(\boldsymbol{v})}(\boldsymbol{v}^T\boldsymbol{p})(\boldsymbol{p}^T\boldsymbol{v})=\sum_{\boldsymbol{p}\in planes(\boldsymbol{v})}\boldsymbol{v}^T(\boldsymbol{p}\boldsymbol{p}^T)\boldsymbol{v}=\boldsymbol{v}^T\sum_{\boldsymbol{p}\in planes(\boldsymbol{v})}\boldsymbol{K_p}\boldsymbol{v}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Δ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.56601em; vertical-align: -1.51601em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.80899em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight">p</span></span></span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.51601em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.56601em; vertical-align: -1.51601em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.80899em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight">p</span></span></span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.51601em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.56601em; vertical-align: -1.51601em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.80899em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight">p</span></span></span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.51601em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.06979em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.161108em;"><span class="" style="top: -2.55em; margin-left: -0.06979em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord boldsymbol mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span></span></span></span></span></span><br>
其中<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">K</mi><mi mathvariant="bold-italic">p</mi></msub><mo>=</mo><mi mathvariant="bold-italic">p</mi><msup><mi mathvariant="bold-italic">p</mi><mi>T</mi></msup><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>a</mi><mn>2</mn></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>b</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>c</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>d</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>b</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>b</mi><mn>2</mn></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>b</mi><mi>c</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>b</mi><mi>d</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>c</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>b</mi><mi>c</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>c</mi><mn>2</mn></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>d</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>d</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>b</mi><mi>d</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>d</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>d</mi><mn>2</mn></msup></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{K_p}=\boldsymbol{p}\boldsymbol{p}^T=\begin{bmatrix}a^2 &amp; ab &amp; ac &amp; ad \\ ab&amp; b^2 &amp; bc &amp; bd \\ ac &amp; bc &amp; c^2 &amp; cd \\ ad &amp; bd &amp; cd &amp; d^2 
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.972218em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.06979em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.161108em;"><span class="" style="top: -2.55em; margin-left: -0.06979em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord boldsymbol mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.08577em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 4.80204em; vertical-align: -2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="mord mathdefault">b</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="mord mathdefault">b</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="mord mathdefault">c</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="mord mathdefault">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="mord mathdefault">c</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mord mathdefault">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65em;"><span class="" style="top: -4.81em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span></span></span><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="mord mathdefault">d</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mord mathdefault">d</span></span></span><span class="" style="top: -1.21em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span><br>
这个基本误差二次型<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">K</mi><mi mathvariant="bold-italic">p</mi></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{K_p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.972218em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.06979em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.161108em;"><span class="" style="top: -2.55em; margin-left: -0.06979em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord boldsymbol mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>可以用来求空间中任何点到平面<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">p</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.63888em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span></span></span></span></span>的距离的平方；而把这些基本的二次型加起来，则可以用一个矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">Q</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88055em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span></span></span></span></span>表示整个平面集。通过这样的定义，简单地将两个二次曲面<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">Q</mi><mn>1</mn></msub><mo>+</mo><msub><mi mathvariant="bold-italic">Q</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\boldsymbol{Q}_1 + \boldsymbol{Q}_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>相加实际上是隐式地跟踪了平面集合，而没有计算前述的复杂的集合并<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mo stretchy="false">)</mo><mo>=</mo><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><msub><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mn mathvariant="bold-italic">1</mn></msub><mo stretchy="false">)</mo><mo>∪</mo><mi>p</mi><mi>l</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><msub><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mn mathvariant="bold-italic">2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">planes(\boldsymbol{\bar{v}})=planes(\boldsymbol{\bar{v}_1})\cup planes(\boldsymbol{\bar{v}_2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>。最开始，所有的点都在自身关联的三角面上，因此<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Δ</mi><mo stretchy="false">(</mo><mi mathvariant="bold-italic">v</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Δ(\boldsymbol{v})=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">Δ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>。这符合<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Δ</mi></mrow><annotation encoding="application/x-tex">Δ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">Δ</span></span></span></span></span>用来衡量简化误差的设计。但<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">K</mi><mi mathvariant="bold-italic">p</mi></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{K_p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.972218em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.06979em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.161108em;"><span class="" style="top: -2.55em; margin-left: -0.06979em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord boldsymbol mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>不为0，每个点的<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">Q</mi><mo>=</mo><mo>∑</mo><msub><mi mathvariant="bold-italic">K</mi><mi mathvariant="bold-italic">p</mi></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}=\sum\boldsymbol{K_p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88055em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="mop op-symbol small-op" style="position: relative; top: -5e-06em;">∑</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.06979em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.161108em;"><span class="" style="top: -2.55em; margin-left: -0.06979em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord boldsymbol mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>也不为0。随着简化进行，新点<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>的<span class="katex--inline">KaTeX parse error: Undefined control sequence: \boldsymbold at position 1: \̲b̲o̲l̲d̲s̲y̲m̲b̲o̲l̲d̲{Q}</span>就等于所缩并的两个旧点<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">v</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{v}_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>, <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">v</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{v}_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">Q</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88055em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span></span></span></span></span>之和。</p>
<p>如果原度量中<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">Q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.93025em; vertical-align: -0.24414em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.93025em; vertical-align: -0.24414em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.206968em;"><span class="" style="top: -2.45586em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.24414em;"><span class=""></span></span></span></span></span></span></span></span></span></span>表示的集合是不相交的，二次加法就等价于集合并集。如果有一些重叠，那么一个平面可能会被计算多次。然而，由于每个平面最初只与3个顶点有关联，所以任何一个平面最多只能被计算3次，这样的误差是可以接受的。</p>
<h2><a id="_55"></a>迭代过程</h2>
<p>按照贪心策略，迭代地从最小堆中删除成本最低的对<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\boldsymbol{v_1},\boldsymbol{v_2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，收缩该顶点对，将<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{v_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>所有的边关系转嫁到<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{v_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>上，并更新涉及原<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{v_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>的所有有效顶点对<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="bold-italic">v</mi><mo mathvariant="bold-italic">∗</mo></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\boldsymbol{v_1},\boldsymbol{v_*})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.180554em;"><span class="" style="top: -2.55em; margin-left: -0.03704em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mathbf mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>的成本。需要注意的是，有些顶点对不能被缩并，否则会产生面翻转（flip）的情况，需要删之前检查。</p>
<p>总地而言，迭代的每一步都是检查、删并、调整的过程。</p>
<h1><a id="_59"></a>算法实现</h1>
<h2><a id="initQEM_60"></a>initQEM</h2>
<p>因为删并过程中需要动态调整堆中的元素键值，因此采用底层用红黑树的<code>std::set</code>的数据结构来维护最小堆，并定义结构体<code>HalfedgeHandle_to_cmp</code>及其用于比较大小的结构体<code>cmp</code>。</p>
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">HalfedgeHandle_to_cmp</span> <span class="token punctuation">{</span>
	size_t e_id<span class="token punctuation">;</span><span class="token comment">//用来找到边</span>
	size_t vid0<span class="token punctuation">,</span> vid1<span class="token punctuation">;</span>
	<span class="token keyword">float</span> cost<span class="token punctuation">;</span><span class="token comment">//代价，用来维护红黑树中的偏序关系</span>
	<span class="token function">HalfedgeHandle_to_cmp</span><span class="token punctuation">(</span>size_t e_id<span class="token punctuation">,</span> size_t v0<span class="token punctuation">,</span> size_t v1<span class="token punctuation">,</span> <span class="token keyword">float</span> c<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">e_id</span><span class="token punctuation">(</span>e_id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cost</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		vid0 <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		vid1 <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">cmp</span> <span class="token punctuation">{</span>
	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">HalfedgeHandle_to_cmp</span> <span class="token keyword">const</span> <span class="token operator">&amp;</span> a<span class="token punctuation">,</span> \
					<span class="token keyword">struct</span> <span class="token class-name">HalfedgeHandle_to_cmp</span> <span class="token keyword">const</span> <span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>cost <span class="token operator">==</span> b<span class="token punctuation">.</span>cost<span class="token punctuation">)</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>e_id <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>e_id<span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>cost <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>cost<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
std<span class="token operator">::</span>set<span class="token operator">&lt;</span>HalfedgeHandle_to_cmp<span class="token punctuation">,</span> cmp<span class="token operator">&gt;</span> min_heap<span class="token punctuation">;</span>
</code></pre>
<p>初始化的第一步是利用周围各个面的p计算每个顶点的误差矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="bold-italic">Q</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88055em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">Q</span></span></span></span></span></span></span>（面法向量和方程的计算在初始化载入时就可以做了）</p>
<pre><code class="prism language-cpp"><span class="token comment">// assumes that mesh has been setup</span>
<span class="token keyword">void</span> <span class="token function">initQEM</span><span class="token punctuation">(</span>zyMesh <span class="token operator">&amp;</span> mesh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	min_heap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t vh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> vh <span class="token operator">&lt;</span> mesh<span class="token punctuation">.</span>vertexList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> vh<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mat44 Q <span class="token operator">=</span> <span class="token function">mat44</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//一个顶点的所有incomin或outgoing半边就对应了这个顶点周围的所有面</span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span> <span class="token keyword">const</span> <span class="token operator">&amp;</span> in_he_ids <span class="token operator">=</span> mesh<span class="token punctuation">.</span>vertexList<span class="token punctuation">[</span>vh<span class="token punctuation">]</span><span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> vh_hei <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> vh_hei <span class="token operator">&lt;</span> in_he_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> vh_hei<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> heh <span class="token operator">=</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>in_he_ids<span class="token punctuation">[</span>vh_hei<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token comment">// CVecf4 p = mesh.faces_p[heh.face_id];</span>
			vec4 <span class="token keyword">const</span> <span class="token operator">&amp;</span> p <span class="token operator">=</span> mesh<span class="token punctuation">.</span>faceData<span class="token punctuation">[</span>heh<span class="token punctuation">.</span>face_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Normal<span class="token punctuation">;</span>
			Q <span class="token operator">+=</span> glm<span class="token operator">::</span><span class="token function">outerProduct</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>vh<span class="token punctuation">]</span><span class="token punctuation">.</span>Q_vert <span class="token operator">=</span> Q<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>初始化第二步是求解每个有效顶点对<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="bold-italic">v</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\boldsymbol{v}_1, \boldsymbol{v}_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>如果要进行缩并的话，其产生的缩并代价<code>cost</code>和缩并后的新顶点位置<code>v_bar</code>。计算公式为如果<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{Q}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.01733em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span>可逆，则直接求解；否则在<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="bold-italic">v</mi><mn>1</mn></msub><msub><mi mathvariant="bold-italic">v</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{v}_1\boldsymbol{v}_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>线段上找一点能使得缩并代价最小。如下所示，<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mo>=</mo><mi>k</mi><mo>∗</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo><mo>∗</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}=k*\boldsymbol{{v}_1}+(1-k)*\boldsymbol{{v}_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.59444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></span><br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mo>=</mo><msup><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover><mo>=</mo><msup><mi>k</mi><mn>2</mn></msup><msup><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>k</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><msup><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mo>+</mo><mi>k</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msup><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mo>+</mo><msup><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">c=\boldsymbol{\bar{v}}^T\boldsymbol{\bar{Q}}\boldsymbol{\bar{v}}=k^2\boldsymbol{{v}_1}^T\boldsymbol{\bar{Q}}\boldsymbol{{v}_1}+(1-k)^2\boldsymbol{{v}_2}^T\boldsymbol{\bar{Q}}\boldsymbol{{v}_2}+k(1-k)(\boldsymbol{{v}_1}^T\boldsymbol{\bar{Q}}\boldsymbol{{v}_2}+\boldsymbol{{v}_2}^T\boldsymbol{\bar{Q}}\boldsymbol{{v}_1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.08577em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.08577em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.14133em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.14133em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.14133em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span><br>
令<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>c</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>k</mi></mrow></mfrac><mo>=</mo><mn>2</mn><mi>k</mi><msup><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo>−</mo><mn>2</mn><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>k</mi><mo stretchy="false">)</mo><msup><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mn>2</mn><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msup><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mo>+</mo><msup><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\frac{\partial{c}}{\partial{k}}= 2k\boldsymbol{{v}_1}^T\boldsymbol{\bar{Q}}\boldsymbol{{v}_1} - 2(1-k)\boldsymbol{{v}_2}^T\boldsymbol{\bar{Q}}\boldsymbol{{v}_2}  + (1-2k)(\boldsymbol{{v}_1}^T\boldsymbol{\bar{Q}}\boldsymbol{{v}_2}+\boldsymbol{{v}_2}^T\boldsymbol{\bar{Q}}\boldsymbol{{v}_1}) = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 2.05744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="margin-right: 0.05556em;">∂</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord" style="margin-right: 0.05556em;">∂</span><span class="mord"><span class="mord mathdefault">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.08577em; vertical-align: -0.19444em;"></span><span class="mord">2</span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.14133em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mclose">)</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.14133em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.14133em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span></span><br>
记<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msup><msub><mi mathvariant="bold-italic">v</mi><mi mathvariant="bold-italic">i</mi></msub><mi>T</mi></msup><mover accent="true"><mi mathvariant="bold-italic">Q</mi><mo>ˉ</mo></mover><msub><mi mathvariant="bold-italic">v</mi><mi mathvariant="bold-italic">j</mi></msub><mtext>&nbsp;</mtext><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">}</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">c_{ij}=\boldsymbol{{v}_i}^T\boldsymbol{\bar{Q}}\boldsymbol{{v}_j} \space (i,j\in \{1,2\})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.12744em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.335282em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord boldsymbol mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.82289em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol">Q</span></span></span><span class="" style="top: -3.25511em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.335282em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord boldsymbol mtight" style="margin-right: 0.0622em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace">&nbsp;</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.05724em;">j</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">2</span><span class="mclose">}</span><span class="mclose">)</span></span></span></span></span>，即<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>∗</mo><msub><mi>c</mi><mn>11</mn></msub><mo>−</mo><msub><mi>c</mi><mn>22</mn></msub><mo>+</mo><mi>k</mi><mo>∗</mo><msub><mi>c</mi><mn>22</mn></msub><mo>+</mo><mn>0.5</mn><mo>∗</mo><mo stretchy="false">(</mo><msub><mi>c</mi><mn>12</mn></msub><mo>+</mo><msub><mi>c</mi><mn>21</mn></msub><mo stretchy="false">)</mo><mo>−</mo><mi>k</mi><mo>∗</mo><mo stretchy="false">(</mo><msub><mi>c</mi><mn>12</mn></msub><mo>+</mo><msub><mi>c</mi><mn>21</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k*c_{11} - c_{22} + k*c_{22} + 0.5*(c_{12}+c_{21}) - k*(c_{12}+c_{21}) = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span></span><br>
解出<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>=</mo><mfrac><mrow><mn>2</mn><mo>∗</mo><msub><mi>c</mi><mn>22</mn></msub><mo>−</mo><msub><mi>c</mi><mn>12</mn></msub><mo>−</mo><msub><mi>c</mi><mn>21</mn></msub></mrow><mrow><mn>2</mn><mo>∗</mo><msub><mi>c</mi><mn>11</mn></msub><mo>+</mo><mn>2</mn><mo>∗</mo><msub><mi>c</mi><mn>22</mn></msub><mo>−</mo><mn>2</mn><mo>∗</mo><msub><mi>c</mi><mn>12</mn></msub><mo>−</mo><mn>2</mn><mo>∗</mo><msub><mi>c</mi><mn>21</mn></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><msub><mi>c</mi><mn>22</mn></msub><mo>−</mo><mn>0.5</mn><mo>∗</mo><mo stretchy="false">(</mo><msub><mi>c</mi><mn>12</mn></msub><mo>+</mo><msub><mi>c</mi><mn>21</mn></msub><mo stretchy="false">)</mo></mrow><mrow><msub><mi>c</mi><mn>11</mn></msub><mo>+</mo><msub><mi>c</mi><mn>22</mn></msub><mo>−</mo><msub><mi>c</mi><mn>12</mn></msub><mo>−</mo><msub><mi>c</mi><mn>21</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">k =\frac{2*c_{22}-c_{12}-c_{21}}{2*c_{11}+2*c_{22}-2*c_{12}-2*c_{21}} = \frac{c_{22} - 0.5*(c_{12}+c_{21})}{c_{11}+c_{22}-c_{12}-c_{21}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.15744em; vertical-align: -0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.263em; vertical-align: -0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br>
解出<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span></span></span></span></span>后检查是否在<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>⩽</mo><mi>k</mi><mo>⩽</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0\leqslant k\leqslant 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.78111em; vertical-align: -0.13667em;"></span><span class="mord">0</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel amsrm">⩽</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83111em; vertical-align: -0.13667em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel amsrm">⩽</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>的范围内，若不在，则最后只能在<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mo separator="true">,</mo><mn>0.5</mn><mo stretchy="false">(</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">1</mn></msub><mo>+</mo><msub><mi mathvariant="bold-italic">v</mi><mn mathvariant="bold-italic">2</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{\boldsymbol{{v}_1}, \boldsymbol{{v}_2}, 0.5(\boldsymbol{{v}_1}+\boldsymbol{{v}_2})\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbf mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">}</span></span></span></span></span>内选择一个代价最小的了。</p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">initQEM</span><span class="token punctuation">(</span>zyMesh <span class="token operator">&amp;</span> mesh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t e_id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> e_id <span class="token operator">&lt;</span> mesh<span class="token punctuation">.</span>edgeList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> e_id<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>		
		HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> heh <span class="token operator">=</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>mesh<span class="token punctuation">.</span>edgeList<span class="token punctuation">[</span>e_id<span class="token punctuation">]</span><span class="token punctuation">.</span>halfedge_1_id<span class="token punctuation">]</span><span class="token punctuation">;</span>

		size_t v1_h <span class="token operator">=</span> heh<span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">,</span> v2_h <span class="token operator">=</span> heh<span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">;</span>
		mat44 Q1 <span class="token operator">=</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v1_h<span class="token punctuation">]</span><span class="token punctuation">.</span>Q_vert<span class="token punctuation">,</span> Q2 <span class="token operator">=</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v2_h<span class="token punctuation">]</span><span class="token punctuation">.</span>Q_vert<span class="token punctuation">;</span>
		mat44 Q_bar <span class="token operator">=</span> Q1 <span class="token operator">+</span> Q2<span class="token punctuation">;</span>
		mat44 Q_bar_zero_LR <span class="token operator">=</span> Q_bar<span class="token punctuation">;</span>
		Q_bar_zero_LR<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span><span class="token comment">// 最后一行（Last Row）赋值为0 0 0 1</span>
		Q_bar_zero_LR<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
		Q_bar_zero_LR<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
		Q_bar_zero_LR<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
		vec4 v_bar<span class="token punctuation">;</span><span class="token comment">//合并后的顶点</span>
		<span class="token keyword">float</span> cost<span class="token punctuation">;</span><span class="token comment">//合并的代价</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">determinant</span><span class="token punctuation">(</span>Q_bar_zero_LR<span class="token punctuation">)</span> <span class="token operator">&gt;</span> invertible_threshold<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 可逆</span>
			v_bar <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">inverse</span><span class="token punctuation">(</span>Q_bar_zero_LR<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			cost <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v_bar<span class="token punctuation">,</span> Q_bar <span class="token operator">*</span> v_bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 不可逆 =&gt; ﬁnd the optimal vertex along the segment v1v2</span>
			vec4 v1 <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v1_h<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v1_h<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v1_h<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			vec4 v2 <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v2_h<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v2_h<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v2_h<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">float</span> v1Qv1 <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> Q_bar <span class="token operator">*</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">float</span> v1Qv2 <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> Q_bar <span class="token operator">*</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 其实Q_bar是对称阵，因此v1Qv2==v2Qv1</span>
			<span class="token keyword">float</span> v2Qv1 <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> Q_bar <span class="token operator">*</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">float</span> v2Qv2 <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> Q_bar <span class="token operator">*</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">float</span> k <span class="token operator">=</span> <span class="token punctuation">(</span>v2Qv2 <span class="token operator">-</span> <span class="token number">0.5</span><span class="token operator">*</span><span class="token punctuation">(</span>v1Qv2<span class="token operator">+</span>v2Qv1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>v1Qv1<span class="token operator">+</span>v2Qv2<span class="token operator">-</span>v1Qv2<span class="token operator">-</span>v2Qv1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> k <span class="token operator">&amp;&amp;</span> k <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				v_bar <span class="token operator">=</span> k<span class="token operator">*</span>v1 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>k<span class="token punctuation">)</span><span class="token operator">*</span>v2<span class="token punctuation">;</span>
				cost <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v_bar<span class="token punctuation">,</span> Q_bar <span class="token operator">*</span> v_bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// If this also fails, we fall back on choosing v¯ from amongst the endpoints and the midpoint.</span>
				vec4 vmid <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>v1 <span class="token operator">+</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">float</span> cmid <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>vmid<span class="token punctuation">,</span> Q_bar <span class="token operator">*</span> vmid<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>cmid <span class="token operator">&lt;</span> v1Qv1 <span class="token operator">&amp;&amp;</span> cmid <span class="token operator">&lt;</span> v2Qv2<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// c1即为v1Qv1 c2即为v2Qv2</span>
					v_bar <span class="token operator">=</span> vmid<span class="token punctuation">;</span>
					cost <span class="token operator">=</span> cmid<span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>v1Qv1 <span class="token operator">&lt;</span> v2Qv2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					v_bar <span class="token operator">=</span> v1<span class="token punctuation">;</span>
					cost <span class="token operator">=</span> v1Qv1<span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					v_bar <span class="token operator">=</span> v2<span class="token punctuation">;</span>
					cost <span class="token operator">=</span> v2Qv2<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>heh<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Q_bar <span class="token operator">=</span> Q_bar<span class="token punctuation">;</span>
		mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>heh<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>v_bar <span class="token operator">=</span> v_bar<span class="token punctuation">;</span>
		mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>heh<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>cost  <span class="token operator">=</span> cost<span class="token punctuation">;</span>
		min_heap<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">HalfedgeHandle_to_cmp</span><span class="token punctuation">(</span>e_id<span class="token punctuation">,</span> v1_h<span class="token punctuation">,</span> v2_h<span class="token punctuation">,</span> cost<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="runQEM_163"></a>runQEM</h2>
<p>首先判断是否还能继续简化（最少顶点数为4）。同时调用一次<code>initQEM()</code>，因为上次简化完之后存储在set中的句柄信息已经失效了（当然这是由于实现不够精巧带来的一些冗余开销）。</p>
<pre><code class="prism language-cpp">size_t <span class="token function">runQEM</span><span class="token punctuation">(</span>zyMesh <span class="token operator">&amp;</span> mesh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	size_t old_n_vertices <span class="token operator">=</span> mesh<span class="token punctuation">.</span>vertexList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	size_t plan_num_del <span class="token operator">=</span> old_n_vertices <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>old_n_vertices <span class="token operator">-</span> plan_num_del <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//简化完只剩不足4个顶点</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"cannot simplify anymore!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">initQEM</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>每次简化预计删并一半数目的顶点。从堆顶取出比较句柄，定位到网格中的半边，如前述，判断缩并这条半边是否可行。如果可行，先要从set中删掉原来与<code>v_from</code>和<code>v_to</code>相连的边的记录，方法是遍历<code>v_from</code>和<code>v_to</code>的所有出射半边和入射半边（注意堆中的比较句柄是以半边为基础的）。</p>
<pre><code class="prism language-cpp">size_t <span class="token function">runQEM</span><span class="token punctuation">(</span>zyMesh <span class="token operator">&amp;</span> mesh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	size_t real_num_del <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plan_num_del<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		HalfedgeHandle_to_cmp top_halfedge <span class="token operator">=</span> <span class="token operator">*</span>min_heap<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//堆顶是代价最小的边 删除后 更新与这条边相连的边的代价</span>
		min_heap<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>min_heap<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从堆中删除</span>
		HalfedgeHandle <span class="token operator">&amp;</span> heh <span class="token operator">=</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>mesh<span class="token punctuation">.</span>edgeList<span class="token punctuation">[</span>top_halfedge<span class="token punctuation">.</span>e_id<span class="token punctuation">]</span><span class="token punctuation">.</span>halfedge_1_id<span class="token punctuation">]</span><span class="token punctuation">;</span>

		mat44 Q_bar_del <span class="token operator">=</span> mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>heh<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Q_bar<span class="token punctuation">;</span>
		vec4 v_bar_del <span class="token operator">=</span> mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>heh<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>v_bar<span class="token punctuation">;</span>

		VertexHandle <span class="token operator">&amp;</span> v_from <span class="token operator">=</span> mesh<span class="token punctuation">.</span>vertexList<span class="token punctuation">[</span>heh<span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
		VertexHandle <span class="token operator">&amp;</span> v_to   <span class="token operator">=</span> mesh<span class="token punctuation">.</span>vertexList<span class="token punctuation">[</span>heh<span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mesh<span class="token punctuation">.</span><span class="token function">is_collapse_OK</span><span class="token punctuation">(</span>heh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			real_num_del<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token comment">// v_from</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> ngb <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ngb <span class="token operator">&lt;</span> v_from<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ngb<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				size_t he_id_del <span class="token operator">=</span> v_from<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">[</span>ngb<span class="token punctuation">]</span><span class="token punctuation">;</span>
				size_t e_id_del  <span class="token operator">=</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>edge_id<span class="token punctuation">;</span>
				min_heap<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">HalfedgeHandle_to_cmp</span><span class="token punctuation">(</span>e_id_del<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">,</span>\
									mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>e_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>cost<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> ngb <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ngb <span class="token operator">&lt;</span> v_from<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ngb<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				size_t he_id_del <span class="token operator">=</span> v_from<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">[</span>ngb<span class="token punctuation">]</span><span class="token punctuation">;</span>
				size_t e_id_del  <span class="token operator">=</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>edge_id<span class="token punctuation">;</span>
				min_heap<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">HalfedgeHandle_to_cmp</span><span class="token punctuation">(</span>e_id_del<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">,</span>\
									mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>e_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>cost<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// v_to</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> ngb <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ngb <span class="token operator">&lt;</span> v_to<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ngb<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				size_t he_id_del <span class="token operator">=</span> v_to<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">[</span>ngb<span class="token punctuation">]</span><span class="token punctuation">;</span>
				size_t e_id_del  <span class="token operator">=</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>edge_id<span class="token punctuation">;</span>
				min_heap<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">HalfedgeHandle_to_cmp</span><span class="token punctuation">(</span>e_id_del<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">,</span>\
									mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>e_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>cost<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> ngb <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ngb <span class="token operator">&lt;</span> v_to<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ngb<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				size_t he_id_del <span class="token operator">=</span> v_to<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">[</span>ngb<span class="token punctuation">]</span><span class="token punctuation">;</span>
				size_t e_id_del  <span class="token operator">=</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>edge_id<span class="token punctuation">;</span>
				min_heap<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">HalfedgeHandle_to_cmp</span><span class="token punctuation">(</span>e_id_del<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">,</span>\
									mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>he_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>e_id_del<span class="token punctuation">]</span><span class="token punctuation">.</span>cost<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>		
<span class="token punctuation">}</span>	
</code></pre>
<p>删除堆中信息后，将新点修改在<code>v</code>（collapse的终点）上，并修改终点的值为该边压缩之后的<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>的坐标。然后更新与最小代价边相连的半边，也就是更新与缩并产生的新顶点<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">v</mi><mo>ˉ</mo></mover></mrow><annotation encoding="application/x-tex">\boldsymbol{\bar{v}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58122em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.58122em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord boldsymbol" style="margin-right: 0.03704em;">v</span></span></span><span class="" style="top: -3.01344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span></span></span></span></span></span></span></span></span></span>相连的半边，修改这些边上的<code>v_bar</code>，<code>Q_bar</code>和<code>cost</code>值。具体实现为遍历<code>v_to</code>的所有出射半边和入射半边，逐条修改，修改的方法跟初始化<code>initQEM</code>中的计算方法类似，不再赘述。</p>
<pre><code class="prism language-cpp">size_t <span class="token function">runQEM</span><span class="token punctuation">(</span>zyMesh <span class="token operator">&amp;</span> mesh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	size_t real_num_del <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plan_num_del<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mesh<span class="token punctuation">.</span><span class="token function">is_collapse_OK</span><span class="token punctuation">(</span>heh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
			<span class="token comment">// 将新点修改在v（collapse的终点）上</span>
			mesh<span class="token punctuation">.</span><span class="token function">zyCollapse</span><span class="token punctuation">(</span>heh<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Position <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>v_bar_del<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v_bar_del<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v_bar_del<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//修改终点的值为该边压缩之后的Vbar的坐标</span>
			mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Q_vert <span class="token operator">=</span> Q_bar_del<span class="token punctuation">;</span>			
			<span class="token comment">// 开始更新与最小代价边相连的边 也就是更新与新merged顶点相连的边</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v_to<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> heh_v_to_outgoing <span class="token operator">=</span> mesh<span class="token punctuation">.</span>halfedgeList<span class="token punctuation">[</span>v_to<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				size_t v_target <span class="token operator">=</span> heh_v_to_outgoing<span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">;</span>
				mat44 Q_bar_update <span class="token operator">=</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_target<span class="token punctuation">]</span><span class="token punctuation">.</span>Q_vert <span class="token operator">+</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Q_vert<span class="token punctuation">;</span>
				mat44 Q_bar_zero_LR <span class="token operator">=</span> Q_bar_update<span class="token punctuation">;</span>
				Q_bar_zero_LR<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span><span class="token comment">// 最后一行（Last Row）赋值为0 0 0 1</span>
				Q_bar_zero_LR<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
				Q_bar_zero_LR<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
				Q_bar_zero_LR<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
				vec4 v_bar_update<span class="token punctuation">;</span><span class="token comment">//合并后的顶点</span>
				<span class="token keyword">float</span> cost_update<span class="token punctuation">;</span><span class="token comment">//合并的代价</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">determinant</span><span class="token punctuation">(</span>Q_bar_zero_LR<span class="token punctuation">)</span> <span class="token operator">&gt;</span> invertible_threshold<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 可逆</span>
					v_bar_update <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">inverse</span><span class="token punctuation">(</span>Q_bar_zero_LR<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					cost_update <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v_bar_update<span class="token punctuation">,</span> Q_bar_update <span class="token operator">*</span> v_bar_update<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// 不可逆 =&gt; ﬁnd the optimal vertex along the segment v1v2</span>
					vec4 v1 <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_target<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_target<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_target<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					vec4 v2 <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertexData<span class="token punctuation">[</span>v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">float</span> v1Qv1 <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> Q_bar_update <span class="token operator">*</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">float</span> v1Qv2 <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> Q_bar_update <span class="token operator">*</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">float</span> v2Qv1 <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> Q_bar_update <span class="token operator">*</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">float</span> v2Qv2 <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> Q_bar_update <span class="token operator">*</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">float</span> k <span class="token operator">=</span> <span class="token punctuation">(</span>v2Qv2 <span class="token operator">-</span> <span class="token number">0.5</span><span class="token operator">*</span><span class="token punctuation">(</span>v1Qv2<span class="token operator">+</span>v2Qv1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>v1Qv1<span class="token operator">+</span>v2Qv2<span class="token operator">-</span>v1Qv2<span class="token operator">-</span>v2Qv1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> k <span class="token operator">&amp;&amp;</span> k <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						v_bar_update <span class="token operator">=</span> k<span class="token operator">*</span>v1 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>k<span class="token punctuation">)</span><span class="token operator">*</span>v2<span class="token punctuation">;</span>
						cost_update <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>v_bar_update<span class="token punctuation">,</span> Q_bar_update <span class="token operator">*</span> v_bar_update<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// If this also fails, we fall back on choosing v¯ from amongst the endpoints and the midpoint.</span>
						vec4 vmid <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>v1 <span class="token operator">+</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">float</span> cmid <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">dot</span><span class="token punctuation">(</span>vmid<span class="token punctuation">,</span> Q_bar_update <span class="token operator">*</span> vmid<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>cmid <span class="token operator">&lt;</span> v1Qv1 <span class="token operator">&amp;&amp;</span> cmid <span class="token operator">&lt;</span> v2Qv2<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// c1即为v1Qv1 c2即为v2Qv2</span>
							v_bar_update <span class="token operator">=</span> vmid<span class="token punctuation">;</span>
							cost_update <span class="token operator">=</span> cmid<span class="token punctuation">;</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>v1Qv1 <span class="token operator">&lt;</span> v2Qv2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							v_bar_update <span class="token operator">=</span> v1<span class="token punctuation">;</span>
							cost_update <span class="token operator">=</span> v1Qv1<span class="token punctuation">;</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
							v_bar_update <span class="token operator">=</span> v2<span class="token punctuation">;</span>
							cost_update <span class="token operator">=</span> v2Qv2<span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>heh_v_to_outgoing<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>Q_bar <span class="token operator">=</span> Q_bar_update<span class="token punctuation">;</span>
				mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>heh_v_to_outgoing<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>v_bar <span class="token operator">=</span> v_bar_update<span class="token punctuation">;</span>
				mesh<span class="token punctuation">.</span>edgeData<span class="token punctuation">[</span>heh_v_to_outgoing<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>cost  <span class="token operator">=</span> cost_update<span class="token punctuation">;</span>
				<span class="token function">assert</span><span class="token punctuation">(</span>v_target <span class="token operator">!=</span> v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
				min_heap<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">HalfedgeHandle_to_cmp</span><span class="token punctuation">(</span>heh_v_to_outgoing<span class="token punctuation">.</span>edge_id<span class="token punctuation">,</span> v_target<span class="token punctuation">,</span> v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">,</span> cost_update<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//重新加入新点与它周围顶点相连的边</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v_to<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// 同上一个for循环</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="helper_functions_295"></a>helper functions</h2>
<h3><a id="is_collapse_OK_296"></a>is_collapse_OK</h3>
<p>在<code>runQEM</code>中需要用到半边网格类<code>zyMesh</code>中判断缩并是否可行的函数<code>is_collapse_OK()</code>，如下所示。这一部分涉及较多的关于网格拓扑的知识，在实现上参考了开源库OpenMesh的一些技巧。</p>
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token function">is_collapse_OK</span><span class="token punctuation">(</span>HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> v0v1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// is the edge already deleted?</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>edgeList<span class="token punctuation">[</span>v0v1<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>deleted<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">// HalfedgeHandle const &amp; v1v0 = halfedgeList[v0v1.oppo_halfedge_id];</span>
    size_t v0_id <span class="token operator">=</span> v0v1<span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">,</span> v1_id <span class="token operator">=</span> v0v1<span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">;</span>

    <span class="token comment">// are vertices already deleted ?</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vertexList<span class="token punctuation">[</span>v0_id<span class="token punctuation">]</span><span class="token punctuation">.</span>deleted <span class="token operator">||</span> vertexList<span class="token punctuation">[</span>v1_id<span class="token punctuation">]</span><span class="token punctuation">.</span>deleted<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    size_t vl_id<span class="token punctuation">,</span> vr_id<span class="token punctuation">;</span>
    <span class="token comment">// the edges v1-vl and vl-v0 must not be both boundary edges</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isOnBoundary</span><span class="token punctuation">(</span>v0v1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//v0v1不在边界上则说明v1v0不为IndexNotValid</span>
        HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> h1 <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>v0v1<span class="token punctuation">.</span>next_halfedge_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
        HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> h2 <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>h1<span class="token punctuation">.</span>next_halfedge_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
        vl_id <span class="token operator">=</span> h1<span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>h1<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">==</span> IndexNotValid <span class="token operator">&amp;&amp;</span> h2<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">==</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// the edges v0-vr and vr-v1 must not be both boundary edges</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>v0v1<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">!=</span> IndexNotValid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> v1v0 <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>v0v1<span class="token punctuation">.</span>oppo_halfedge_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
        HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> h1 <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>v1v0<span class="token punctuation">.</span>next_halfedge_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
        HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> h2 <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>h1<span class="token punctuation">.</span>next_halfedge_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
        vr_id <span class="token operator">=</span> h1<span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>h1<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">==</span> IndexNotValid <span class="token operator">&amp;&amp;</span> h2<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">==</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// if vl and vr are equal or both invalid -&gt; fail</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vl_id <span class="token operator">==</span> vr_id<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">// test intersection of the one-rings of v0 and v1</span>
    std<span class="token operator">::</span>unordered_set<span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span> v0_one_rings<span class="token punctuation">;</span>
    VertexHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> v0 <span class="token operator">=</span> vertexList<span class="token punctuation">[</span>v0_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
    VertexHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> v1 <span class="token operator">=</span> vertexList<span class="token punctuation">[</span>v1_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v0<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        v0_one_rings<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>v0<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v0<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        v0_one_rings<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>v0<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token operator">::</span>unordered_set<span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span> v0v1_one_rings_intersect<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v1<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v0_one_rings<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>v1<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">)</span> <span class="token operator">!=</span> v0_one_rings<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            v0v1_one_rings_intersect<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>v1<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v1<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v0_one_rings<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>v1<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">)</span> <span class="token operator">!=</span> v0_one_rings<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            v0v1_one_rings_intersect<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>v1<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>unordered_set<span class="token operator">&lt;</span>size_t<span class="token operator">&gt;</span><span class="token operator">::</span>iterator it <span class="token operator">=</span> v0v1_one_rings_intersect<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> v0v1_one_rings_intersect<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>it <span class="token operator">!=</span> vl_id <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>it <span class="token operator">!=</span> vr_id<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> isOnBoundary_v1v0 <span class="token operator">=</span> <span class="token punctuation">(</span>v0v1<span class="token punctuation">.</span>oppo_halfedge_id<span class="token operator">==</span>IndexNotValid<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token function">isOnBoundary</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>v0v1<span class="token punctuation">.</span>oppo_halfedge_id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// edge between two boundary vertices should be a boundary edge</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">isOnBoundary</span><span class="token punctuation">(</span>v0<span class="token punctuation">)</span>   <span class="token operator">&amp;&amp;</span>  <span class="token function">isOnBoundary</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span><span class="token function">isOnBoundary</span><span class="token punctuation">(</span>v0v1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isOnBoundary_v1v0<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">// passed all tests</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>其中，如果半边的反向半边是无效的index，则判定为半边处于网格边界上。而对于顶点，它处于网格边界，当且仅当它的所有入射和出射半边中有位于网格边界的。如下所示。</p>
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token function">isOnBoundary</span><span class="token punctuation">(</span>HalfedgeHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> heh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>heh<span class="token punctuation">.</span>face_id <span class="token operator">!=</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> heh<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">==</span> IndexNotValid<span class="token punctuation">;</span><span class="token comment">// || heh.face_id == IndexNotValid;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">isOnBoundary</span><span class="token punctuation">(</span>VertexHandle <span class="token keyword">const</span> <span class="token operator">&amp;</span> vh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vh<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isOnBoundary</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>vh<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vh<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isOnBoundary</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>vh<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="zycollapse_391"></a>zycollapse</h3>
<p><code>zyMesh</code>类中负责具体执行缩并操作的成员函数为<code>zyCollapse()</code>，它的逻辑是首先删除给定的半边所属于的那个面；如果它有有效的反向半边，也删除反向半边所属于的面。然后移动所有受到影响的半边，将原来指向<code>v_from</code>的半边改为指向<code>v_to</code>，将原从<code>v_from</code>指出的改为从<code>v_to</code>指出。</p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">zyCollapse</span><span class="token punctuation">(</span>HalfedgeHandle <span class="token operator">&amp;</span> _hh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// remove faces</span>
    size_t oppo_he_id <span class="token operator">=</span> _hh<span class="token punctuation">.</span>oppo_halfedge_id<span class="token punctuation">;</span>
    <span class="token function">delete_around</span><span class="token punctuation">(</span>_hh<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oppo_he_id <span class="token operator">!=</span> IndexNotValid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">delete_around</span><span class="token punctuation">(</span>halfedgeList<span class="token punctuation">[</span>oppo_he_id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// move halfedges</span>
    VertexHandle <span class="token operator">&amp;</span> v_to   <span class="token operator">=</span> vertexList<span class="token punctuation">[</span>_hh<span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
    VertexHandle <span class="token operator">&amp;</span> v_from <span class="token operator">=</span> vertexList<span class="token punctuation">[</span>_hh<span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">]</span><span class="token punctuation">;</span> v_from<span class="token punctuation">.</span>deleted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// 将原指向v_from的改为指向v_to</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v_from<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        HalfedgeHandle <span class="token operator">&amp;</span> he_p2_vfrom <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>v_from<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// halfedge point to v_from</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>he_p2_vfrom<span class="token punctuation">.</span>deleted<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//这条边仍有效</span>
            he_p2_vfrom<span class="token punctuation">.</span>to_vertex_id <span class="token operator">=</span> v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">;</span>
            v_to<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>he_p2_vfrom<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>he_p2_vfrom<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">==</span> IndexNotValid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 如果原指向v_from的这条半边已经没有了对半边，则从v_to的出射半边中找，而边的归属归新的边</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v_to<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 找到和它重新匹配的半边</span>
                    HalfedgeHandle <span class="token operator">&amp;</span> he_pf_vto <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>v_to<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//halfedge point from v_to</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>he_pf_vto<span class="token punctuation">.</span>to_vertex_id <span class="token operator">==</span> he_p2_vfrom<span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">)</span> 
                        <span class="token function">make_halfedges_pair</span><span class="token punctuation">(</span>he_pf_vto<span class="token punctuation">,</span> he_p2_vfrom<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// 如果原指向v_from的这条半边仍然有对半边，则它和它的对半边不动，全部移交给v_to</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将原从v_from指出的改为从v_to指出</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v_from<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        HalfedgeHandle <span class="token operator">&amp;</span> he_pf_vfrom <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>v_from<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// halfedge point from v_from</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>he_pf_vfrom<span class="token punctuation">.</span>deleted<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//这条边仍有效</span>
            he_pf_vfrom<span class="token punctuation">.</span>from_vertex_id <span class="token operator">=</span> v_to<span class="token punctuation">.</span>vertex_id<span class="token punctuation">;</span>
            v_to<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>he_pf_vfrom<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>he_pf_vfrom<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">==</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 如果原从v_from指出的这条半边已经没有了对半边，则从v_to的入射半边中找，而边的归属归新的边</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v_to<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 找到和它重新匹配的半边</span>
                    HalfedgeHandle <span class="token operator">&amp;</span> he_p2_vto <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>v_to<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// halfedge point to v_to</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>he_p2_vto<span class="token punctuation">.</span>from_vertex_id <span class="token operator">==</span> he_pf_vfrom<span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">)</span>
                        <span class="token function">make_halfedges_pair</span><span class="token punctuation">(</span>he_p2_vto<span class="token punctuation">,</span> he_pf_vfrom<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// 如果原从v_from指出的这条半边仍然有对半边，则它和它的对半边不动，全部移交给v_to</span>
			<span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>而需要注意的是，在<code>zyCollapse()</code>中，调整受到影响的半边的指向或来源顶点时，需要做半边配对的重组。这是因为面被删除了（塌缩了），原来不是互为反向半边的两条半边会<strong>靠拢</strong>到一块，称为“结对子”。</p>
<p>对于将原指向<code>v_from</code>的半边改为指向<code>v_to</code>的过程中，如果原指向<code>v_from</code>的这条半边已经没有了反向半边，则从<code>v_to</code>的出射半边中找它的新的反向半边，相互“结对子”，而边的归属为新的反向半边所属的边（edge）；如果还有反向半边，则它和它的反向半边不动，全部移交给<code>v_to</code>（移交操作在<code>zyCollapse()</code>中的<code>push_back</code>中完成）。对于将原从<code>v_from</code>指出的改为从<code>v_to</code>指出的过程，同理。具体的“结对子”过程由<code>make_halfedges_pair()</code>完成，如下所示：</p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">make_halfedges_pair</span><span class="token punctuation">(</span>HalfedgeHandle <span class="token operator">&amp;</span> host<span class="token punctuation">,</span> HalfedgeHandle <span class="token operator">&amp;</span> guest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>host<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">==</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    host<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">=</span> guest<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">;</span>

    <span class="token function">assert</span><span class="token punctuation">(</span>guest<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">==</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    guest<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">=</span> host<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">;</span>

    guest<span class="token punctuation">.</span>edge_id <span class="token operator">=</span> host<span class="token punctuation">.</span>edge_id<span class="token punctuation">;</span>
    <span class="token comment">// 更新边的信息</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>edgeList<span class="token punctuation">[</span>host<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>halfedge_1_id <span class="token operator">==</span> host<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">)</span>
        edgeList<span class="token punctuation">[</span>host<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>halfedge_2_id <span class="token operator">=</span> guest<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>edgeList<span class="token punctuation">[</span>host<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>halfedge_2_id <span class="token operator">==</span> host<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">)</span>
        edgeList<span class="token punctuation">[</span>host<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>halfedge_1_id <span class="token operator">=</span> guest<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>edgeList<span class="token punctuation">[</span>host<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>halfedge_1_id <span class="token operator">!=</span> IndexNotValid <span class="token operator">&amp;&amp;</span> edgeList<span class="token punctuation">[</span>host<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>halfedge_2_id <span class="token operator">!=</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 修改guest的前后半边信息不用修改！</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>zyCollapse()</code>中用到的<code>delete_around()</code>函数将删除一条半边所属的面上所有半边的操作，转化为删除每一条半边的<code>delete_halfedge()</code>函数的调用：</p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">delete_around</span><span class="token punctuation">(</span>HalfedgeHandle <span class="token operator">&amp;</span> hh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    size_t start_he_id <span class="token operator">=</span> hh<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">,</span> he_id <span class="token operator">=</span> start_he_id<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        HalfedgeHandle <span class="token operator">&amp;</span> he_del <span class="token operator">=</span> halfedgeList<span class="token punctuation">[</span>he_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
        he_id <span class="token operator">=</span> he_del<span class="token punctuation">.</span>next_halfedge_id<span class="token punctuation">;</span>
        <span class="token function">delete_halfedge</span><span class="token punctuation">(</span>he_del<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>he_id <span class="token operator">!=</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">delete_halfedge</span><span class="token punctuation">(</span>HalfedgeHandle <span class="token operator">&amp;</span> hh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hh<span class="token punctuation">.</span>deleted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// 更新和它有关系的顶点</span>
    VertexHandle <span class="token operator">&amp;</span> v_to <span class="token operator">=</span> vertexList<span class="token punctuation">[</span>hh<span class="token punctuation">.</span>to_vertex_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">remove_from_vector</span><span class="token punctuation">(</span>v_to<span class="token punctuation">.</span>incoming_halfedge_ids<span class="token punctuation">,</span> hh<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    VertexHandle <span class="token operator">&amp;</span> v_from <span class="token operator">=</span> vertexList<span class="token punctuation">[</span>hh<span class="token punctuation">.</span>from_vertex_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">remove_from_vector</span><span class="token punctuation">(</span>v_from<span class="token punctuation">.</span>outgoing_halfedge_ids<span class="token punctuation">,</span> hh<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 更新和它有关系的所有半边！</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hh<span class="token punctuation">.</span>next_halfedge_id <span class="token operator">!=</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">{</span>
        halfedgeList<span class="token punctuation">[</span>hh<span class="token punctuation">.</span>next_halfedge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>prev_halfedge_id <span class="token operator">=</span> IndexNotValid<span class="token punctuation">;</span>
        hh<span class="token punctuation">.</span>next_halfedge_id <span class="token operator">=</span> IndexNotValid<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hh<span class="token punctuation">.</span>prev_halfedge_id <span class="token operator">!=</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">{</span>
        halfedgeList<span class="token punctuation">[</span>hh<span class="token punctuation">.</span>prev_halfedge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>next_halfedge_id <span class="token operator">=</span> IndexNotValid<span class="token punctuation">;</span>
        hh<span class="token punctuation">.</span>prev_halfedge_id <span class="token operator">=</span> IndexNotValid<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hh<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">!=</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">{</span> 
        halfedgeList<span class="token punctuation">[</span>hh<span class="token punctuation">.</span>oppo_halfedge_id<span class="token punctuation">]</span><span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">=</span> IndexNotValid<span class="token punctuation">;</span>
        hh<span class="token punctuation">.</span>oppo_halfedge_id <span class="token operator">=</span> IndexNotValid<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 更新和它有关系的边</span>
    EdgeHandle <span class="token operator">&amp;</span> edge <span class="token operator">=</span> edgeList<span class="token punctuation">[</span>hh<span class="token punctuation">.</span>edge_id<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>edge<span class="token punctuation">.</span>halfedge_1_id <span class="token operator">==</span> hh<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">)</span>
        edge<span class="token punctuation">.</span>halfedge_1_id <span class="token operator">=</span> IndexNotValid<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>edge<span class="token punctuation">.</span>halfedge_2_id <span class="token operator">==</span> hh<span class="token punctuation">.</span>halfedge_id<span class="token punctuation">)</span>
        edge<span class="token punctuation">.</span>halfedge_2_id <span class="token operator">=</span> IndexNotValid<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Error: could not find corresponding edge when deleting halfedge "</span> <span class="token operator">&lt;&lt;</span> hh<span class="token punctuation">.</span>halfedge_id <span class="token operator">&lt;&lt;</span> <span class="token string">"!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>edge<span class="token punctuation">.</span>halfedge_1_id <span class="token operator">==</span> IndexNotValid <span class="token operator">&amp;&amp;</span> edge<span class="token punctuation">.</span>halfedge_2_id <span class="token operator">==</span> IndexNotValid<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//这条边已经没有了存在的意义</span>
        edge<span class="token punctuation">.</span>deleted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        hh<span class="token punctuation">.</span>edge_id <span class="token operator">=</span> IndexNotValid<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="_514"></a>交互控制简化程度</h1>
<p>为了给用户交互式地控制简化选项，程序中设置了最大简化等级<code>max_level</code>（用户运行程序时输入的参数，具体运行方式见README.md文件），在渲染前，程序调用<code>genMeshes()</code>函数，会自动生成一系列（简化等级为0~<code>max_level</code>-1）的网格。</p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">genMeshes</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string filename_nopfx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> level<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>zyMesh<span class="token operator">&gt;</span> <span class="token operator">&amp;</span> meshList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	meshList<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">zyMesh</span><span class="token punctuation">(</span>filename_nopfx<span class="token operator">+</span><span class="token string">".obj"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	zyMesh tmp_mesh<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> start_time<span class="token punctuation">,</span> end_time<span class="token punctuation">;</span>
	std<span class="token operator">::</span>string in_filename <span class="token operator">=</span> filename_nopfx<span class="token operator">+</span><span class="token string">".obj"</span><span class="token punctuation">,</span> out_filename<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> level<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		l<span class="token operator">++</span><span class="token punctuation">;</span>
		out_filename <span class="token operator">=</span> filename_nopfx <span class="token operator">+</span> <span class="token string">"-smpf-"</span> <span class="token operator">+</span> std<span class="token operator">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".obj"</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"doing %d-th level of simplification...  "</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
		start_time <span class="token operator">=</span> <span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		tmp_mesh <span class="token operator">=</span> <span class="token function">zyMesh</span><span class="token punctuation">(</span>in_filename<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//中间网格不需要设置openGL相关的数据</span>
		size_t numVerts_del <span class="token operator">=</span> <span class="token function">runQEM</span><span class="token punctuation">(</span>tmp_mesh<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 做完简化之后的mesh已经不是原来的样子了（vertexData已变）</span>
		tmp_mesh<span class="token punctuation">.</span><span class="token function">write_obj</span><span class="token punctuation">(</span>out_filename<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshList<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">zyMesh</span><span class="token punctuation">(</span>out_filename<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		end_time <span class="token operator">=</span> <span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"cost %u ms with %u vertices deleted.\n"</span><span class="token punctuation">,</span> end_time<span class="token operator">-</span>start_time<span class="token punctuation">,</span> numVerts_del<span class="token punctuation">)</span><span class="token punctuation">;</span>
		in_filename <span class="token operator">=</span> out_filename<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>而在渲染循环中，每帧都调用<code>processInput()</code>函数，来根据用户对键盘左右方向键的长按操作来实现简化等级的切换。</p>
<pre><code class="prism language-cpp"><span class="token comment">// process all input: query GLFW whether relevant keys are pressed/released this frame and react accordingly</span>
<span class="token keyword">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_LEFT<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span><span class="token punctuation">{</span>
        smpf_level_f <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> smpf_level_f<span class="token operator">-</span><span class="token number">0.001f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        smpf_level <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>smpf_level_f<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
        
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_RIGHT<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span><span class="token punctuation">{</span>
        smpf_level_f <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>max_level<span class="token punctuation">,</span> smpf_level_f<span class="token operator">+</span><span class="token number">0.001f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        smpf_level <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>smpf_level_f<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="_554"></a>效果</h1>
<h2><a id="_555"></a>斯坦福兔子</h2>
<p>从上到下、从左到右依次简化。左上角的为原网格。如继续化简，最后为一个四面体。</p>
<table>
    <tbody><tr>
        <td><center><img src="https://img-blog.csdnimg.cn/793404b20a84446caa11a20170f684b3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
        <td><center><img src="https://img-blog.csdnimg.cn/c2f5cd7273b9456295cf627e872d140b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
    </tr>
    <tr>
        <td><center><img src="https://img-blog.csdnimg.cn/bb96427dd66d4742b76c2c039dc22d38.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
        <td><center><img src="https://img-blog.csdnimg.cn/74396f86803644328377029eb4a88234.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
    </tr>
    <tr>
        <td><center><img src="https://img-blog.csdnimg.cn/a79ab4d8bd1842708d3287d1f2555187.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
        <td><center><img src="https://img-blog.csdnimg.cn/45f6a5d0704044f0b1544cf7483ace20.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
    </tr>
</tbody></table>
<h2><a id="_572"></a>斯坦福牛</h2>
<p>从上到下、从左到右依次简化。左上角的为原网格。如继续化简，最后为一个四面体。</p>
<table>
    <tbody><tr>
        <td><center><img src="https://img-blog.csdnimg.cn/baf7b165b2cd4079b549378e3b3b1662.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
        <td><center><img src="https://img-blog.csdnimg.cn/7113356086cd4cb5a998e941ae728dd6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
    </tr>
    <tr>
        <td><center><img src="https://img-blog.csdnimg.cn/f714c83f45e14bfb9f30f15cbec92dbf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
        <td><center><img src="https://img-blog.csdnimg.cn/b18faa4945b0476aa6f69e2a73a3d39a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
    </tr>
    <tr>
        <td><center><img src="https://img-blog.csdnimg.cn/2bc2f2581d6d43019527b9b0186c861c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
        <td><center><img src="https://img-blog.csdnimg.cn/c57e55ffbdf44bba8f8c39d1ccc8eaf5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAem9uZ3kxNw==,size_20,color_FFFFFF,t_70,g_se,x_16"></center></td>
    </tr>
</tbody></table>

    </div>
  </div>
</body>

</html>
